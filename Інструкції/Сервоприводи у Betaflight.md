# Сервоприводи у Betaflight

Для того щоб мати змогу "спілкуватись" з сервами в Betaflight в принципі - треба прошивати польотник прошивкою, яка зібрана з флагом **SERVOS**.  
"Спілкування" відбувається через генерацію PWM(ШІМ)-сигналу на стороні польотника та передачі його по дроту до сервоприводу, всередині його є мікросхема яка розуміє PWM та робить відповідні зміни. Ще бувають серви з підтримкою PPM додатково або замість класичного PWM.  
В налаштуваннях польотника є дві реалізації логіки роботи з сервами: **SERVO_TILT** та **CHANEL_FORWARDING**.  

## SERVO_TILT
**SERVO_TILT** - оригінально був придуманий для контролю підвіса камери, або може використовуватись (і використовується) для звичайних серв.  
У цього режима у Betaflight є обмеження - працюють лише перші дві серви. З історичних причин - одна серва відповідає за нахил по pitch, інша - по yaw. Відповідно - якщо у вас більше сервоприводів, більше за два, - цей режим в чистому вигляді не підходить.  
Уявіть собі ситуацію - у вас поворотний механізм камери (одна серва), скид на дві серви та ще нахилятор антени (одна серва). Загалом 4 серви, але в режимі SERVO_TILT працювати будуть лише дві з них.  
Варіанти рішення:
- використовувати CHANEL_FORWARDING
- використовувати окремі плати-спліттери на Arduino, які можуть приймати на вхід 1 PWM сигнал мати в ньому, скажімо, 10 положень/комбінацій, і видавати 4 вихідні сигнали з заздалегідь законфігурованими значеннями які підповідають 10-м вхідним комбінаціям. (Без можливості плавної регулбовки - лише 1000/2000)
- використовувати модифіковану авторську прошивку Betaflight, де ця проблема вирішена (більш того - робота з сервами покращена)

### CHANEL_FORWARDING
**CHANEL_FORWARDING** -  особливий режим, в якому значення радіоканалів AUX просто беруть і НАПРЯМУ перекидаються на сервоприводи.  
Для його правильної роботи - треба правильно визначити зсув, починаючи з якого каналу робити прокидування на сервопривод.  
`set channel_forwarding_start = 4 (default)`
Це змінна означає: бери дані з каналу AUX1 (в данному приколаді) та передавай на SERVO1, бери з AUX2 - передавай на SERVO2, бери з AUX3 - передавай на SERVO3 і т.д.  
По замовчуванню 4 - бо перші чотири радіоканали - чи керування AETR, далі йде четверний канал - AUX1.  
Можна поставити, наприклад не 4 а 6. Тоді AUX1 та AUX2 будуть не задіяні в магії хз сервоприводами. А починаючи з AUX3 -задіяні.  
Але у цього режиму є особливість - він тупо бере значення з радіо і напряму впихує його в серву. Тобто цьому режиму без різниці яку красиву табличку ви налаштувати на вкладці Servos у Betaflight Configurator - він її не читає. Він просто перекидає значення з одного місяця в інше.  
А це значить наступне: стандартний діапазон значень які приходять від пульта лежать в межах 1000-2000 мікросекунд.  
В той час як більшість сервоприводів в наші часи розуміє 500-2500. Відповідно якщо до серви буде доходити сигнал 1000-2000, то максимальний кут розкриття буде обмежений програмно і становитиме 90°, замість ~180° які можна отримати від 500-2500.  
Якщо коротко: при CHANEL_FORWARDING поворотна камера буде обератись на 90°, а не ~180° як могла б.  
Примітка: при SERVO_TILT було теж саме протягом років, поки не з'явився цей [**коміт**](https://github.com/betaflight/betaflight/pull/13451 "коміт"), який доступний починаючи з версії Betaflight 4.5.0-rc3  

Офіційний мануал по сервам від Betaflight: https://betaflight.com/docs/wiki/guides/current/servos-and-servo_tilt-for-3-1

Кілька відео, але дивіться обережно - автори не завжди знають та розуміють що написано вище.  
https://www.youtube.com/watch?si=8sGpxN7HP7Kl62Hb&v=-hFveTprcKY  
https://www.youtube.com/watch?v=ELKXNrUduYA  
